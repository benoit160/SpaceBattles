@layout MainLayout
@page "/UniverseCreator"
@using SpaceBattles.Core.Application.Services
@using SpaceBattles.Core.Domain.Models

<div class=@(showCreationScreen? "d-none" : "")>
    <MudContainer MaxWidth="MaxWidth.ExtraSmall">
        <MudPaper Class="pa-4 rounded-xl">
            <EditForm Model="@model" OnValidSubmit="OnValidSubmit">
                <DataAnnotationsValidator/>
                <MudStack>

                    <MudTextField Class="pb-4" Label="Save name" @bind-Value="model.UniverseName" Required For="@(() => model.UniverseName)" Immediate />

                    <MudSlider Class="pb-4" @bind-Value="model.UniverseSpeed" Color="Color.Info" Variant="Variant.Filled" TickMarks Min="1" Max="10" Step="1" ValueLabel >Universe speed</MudSlider>

                    <!--
                    <MudSlider Value="model.NumberOfPlanets" ValueLabel Min="1" Max="100" Step="1" TickMarks>Number of planets</MudSlider>

                    <MudSwitch T="bool" Label="Peacefull mode" Color="Color.Primary" Class="py-4"/>                
                    -->

                    <MudButton ButtonType="ButtonType.Submit" Class="align-self-center" Variant="Variant.Filled" Color="Color.Info">Start new game</MudButton>

                </MudStack>            

            </EditForm>
        </MudPaper>
    </MudContainer>
</div>

<div class=@(showCreationScreen? "" : "d-none")>
    <UniverseCreationWaiter @ref="universeCreationWaiter"/>
</div>

@code {
    [Inject]
    private NavigationManager NavigationManager { get; init; } = default!;

    [Inject]
    private GameState GameState { get; init; } = default!;

    private UniverseCreationModel model = new UniverseCreationModel();

    private UniverseCreationWaiter? universeCreationWaiter;

    private bool showCreationScreen = false;

    private async Task OnValidSubmit()
    {
        showCreationScreen = true;
        Task waitingScreen = universeCreationWaiter!.ShowWaitingScreen();
        
        GameState.Initialize();

        await waitingScreen;

        NavigationManager.NavigateTo("/Overview");
    }
}