@page "/Shipyard"
@using SpaceBattles.Core.Domain.Entities.Battle
@layout GameLayout

@inject GameState GameState

<MudContainer MaxWidth="MaxWidth.Large" Style="overflow-y:scroll; max-height:calc(100vh - var(--mud-appbar-height);">
    <MudGrid Class="py-3" Spacing="0" Justify="Justify.Center">
        @for (int i = 0; i < _spaceships.Count; i++)
        {
            int localIndex = i;
            @SpaceshipCard(localIndex);
        }
    </MudGrid>
</MudContainer>

@code {
    private List<CombatEntityInventory> _spaceships = [];

    protected override void OnInitialized()
    {
        _spaceships = GameState.CurrentPlanet.Spaceships
            .Where(inv => !(inv.CombatEntity as Spaceship).Characteristics.HasFlag(SpaceshipsCharacteristics.Utility))
            .ToList();
    }
    
    private string GetImageStyle(CombatEntityInventory inv)
    {
        return !GameState.CurrentPlanet.MeetsBuildingRequirements(inv.CombatEntity) ? "filter: grayscale(1)" : "";
    }

    private RenderFragment SpaceshipCard(int index)
    {
        return
        @<MudItem xs="12" md="5">
            <MudPaper Class="pa-2 ma-1">
                <MudStack Row>
                    <MudImage Src="@_spaceships[index].CombatEntity.ImagePath" Alt="a visual representation of this spaceship" Class="align-self-center rounded-lg" Width="150" Height="150" Style="@(GetImageStyle(_spaceships[index]))"/>

                    <MudStack Class="flex-grow-1">
                        <MudText Typo="Typo.h5" Style="font-family:TitleFont">@_spaceships[index].CombatEntity.Name</MudText>
                        <MudDivider/>
                        <MudText Color="Color.Info" Typo="Typo.h6">@_spaceships[index].Quantity available</MudText>

                        <MudSpacer/>
                    </MudStack>
                </MudStack>
            </MudPaper>
        </MudItem>;
    }
}